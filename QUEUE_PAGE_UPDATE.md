# 📋 点歌队列页面更新文档

## 更新概述

将点歌队列功能入口添加到侧边栏菜单"播客电台"下方，并创建了一个独立的队列页面，采用类似专辑列表的网格布局样式。

**更新时间**: 2025-10-13  
**状态**: ✅ 已完成并部署

---

## 🎯 更新内容

### 1. 菜单入口添加

**位置**: 左侧导航栏，播客电台下方

**文件**: `SPlayer/src/components/Global/Menu.vue`

**变更**:
```javascript
// 在播客电台菜单项后添加
{
  label: () =>
    h(
      RouterLink,
      {
        to: {
          name: "song-queue",
        },
      },
      () => ["点歌队列"],
    ),
  key: "song-queue",
  icon: renderIcon("queue-music"),
},
```

**效果**:
- 侧边栏显示"点歌队列"菜单项
- 图标：队列音乐图标
- 点击后跳转到队列页面

---

### 2. 队列页面创建

**文件**: `SPlayer/src/views/Queue/index.vue`

**设计风格**: 类似专辑列表，采用网格卡片布局

#### 页面结构

##### 顶部标题区
- **左侧**：页面标题"🎵 点歌队列" + 统计信息（歌曲数量、总时长）
- **右侧**：操作按钮组
  - 开启/关闭队列模式按钮
  - 刷新队列按钮
  - 清空队列按钮

##### 统计卡片区（4列网格）
1. **队列歌曲**: 显示总数（带数字动画）
2. **总时长**: 显示格式化时长
3. **点歌人数**: 显示不同点歌人数量
4. **队列状态**: 显示当前状态（播放中/待机中）

##### 歌曲网格区
- **布局**: 响应式网格（自适应列数）
  - PC端：每行最多显示多列（根据屏幕宽度）
  - 移动端：自动调整列数
- **卡片样式**: 类似专辑卡片
  - 封面图片（正方形）
  - 序号徽章（左上角）
  - 操作按钮（右下角，悬停显示）
  - 当前播放徽章（右上角，仅当前播放歌曲显示）
  - 歌曲信息（卡片下方）
    - 歌曲名称
    - 艺术家
    - 点歌人
    - 添加时间

##### 空状态
- 大尺寸队列图标
- 提示文字："队列为空，快去添加歌曲吧！"
- "去发现音乐"按钮，跳转到发现页面

---

### 3. 路由配置

**文件**: `SPlayer/src/router/routes.js`

**新增路由**:
```javascript
{
  path: "/song-queue",
  name: "song-queue",
  meta: {
    title: "点歌队列",
  },
  component: () => import("@/views/Queue/index.vue"),
}
```

**访问路径**: `/song-queue`

---

## 🎨 页面功能详解

### 1. 实时数据同步

- **自动刷新**: 页面挂载时启动轮询（每5秒）
- **统计信息**: 实时显示队列统计数据
- **状态同步**: 多用户查看同一队列

### 2. 队列控制

#### 开启队列模式
- 按钮文字：
  - 未开启："开启队列模式"
  - 已开启："队列播放中"（主色调）
- 功能：当前歌曲播放完后自动播放队列歌曲
- 限制：队列为空时按钮禁用

#### 刷新队列
- 手动触发队列数据同步
- 同时刷新统计信息
- 显示成功提示

#### 清空队列
- 二次确认弹窗
- 清空所有队列歌曲
- 重置统计信息
- 队列为空时按钮禁用

### 3. 歌曲卡片交互

#### 悬停效果
- 卡片轻微上浮
- 显示操作按钮（移除按钮）

#### 当前播放标识
- 卡片边框高亮（主色调）
- 右上角"正在播放"徽章
- 绿色标签 + 音乐图标

#### 移除操作
- 点击卡片右下角的 ❌ 按钮
- 二次确认弹窗
- 移除后自动刷新统计

### 4. 数据展示

#### 时间格式化
- 刚刚（1分钟内）
- X分钟前（1小时内）
- X小时前（1天内）
- 显示日期（超过1天）

#### 时长格式化
- 格式：MM:SS
- 示例：3:45、45:23

#### 统计信息
- 队列歌曲数量（数字动画）
- 总时长（格式化显示）
- 不同点歌人数量
- 队列状态标签

---

## 📱 响应式设计

### PC端（>768px）
- 网格布局：每行4-6列（自适应）
- 卡片宽度：200px-250px
- 间距：20px
- 标题和操作按钮横向排列

### 移动端（≤768px）
- 网格布局：每行2-3列（自适应）
- 卡片宽度：150px
- 间距：12px
- 标题和操作按钮纵向排列
- 统计卡片自适应布局

---

## 🎯 用户操作流程

### 查看队列
```
侧边栏点击"点歌队列"
  ↓
进入队列页面
  ↓
查看所有排队歌曲（网格布局）
  ↓
查看统计信息（顶部卡片）
```

### 开启队列播放
```
进入队列页面
  ↓
点击"开启队列模式"按钮
  ↓
状态变为"队列播放中"
  ↓
当前歌曲播放完后自动播放队列歌曲
```

### 管理队列
```
悬停歌曲卡片
  ↓
点击右下角 ❌ 按钮
  ↓
确认移除
  ↓
歌曲从队列中删除
```

---

## 🎨 视觉设计

### 布局风格
- **整体**: 类似专辑/歌单列表页面
- **网格**: 响应式网格，自适应列数
- **卡片**: 正方形封面 + 下方信息区

### 配色方案
- **当前播放**: 使用主题色高亮
- **状态标签**: 
  - 播放中：成功色（绿色）
  - 待机中：默认色（灰色）
- **操作按钮**: 错误色（红色）用于删除

### 动画效果
- **卡片悬停**: 上浮 4px + 阴影增强
- **列表动画**: 添加/移除时淡入淡出 + 缩放
- **数字动画**: 统计数字变化时动画过渡

---

## 🔧 技术实现

### 状态管理
使用 Pinia Store (`queueData`)
- 队列数据：`queue.queue`
- 队列长度：`queue.queueLength`
- 队列模式：`queue.queueMode`
- 当前播放ID：`queue.currentQueueId`

### API调用
```javascript
// 获取队列
await queue.refreshQueue()

// 获取统计
await getQueueStats()

// 移除歌曲
await queue.removeSong(id)

// 清空队列
await queue.clear()
```

### 轮询机制
```javascript
onMounted(() => {
  queue.refreshQueue();
  fetchStats();
  
  // 启动轮询（每5秒）
  if (!queue.pollingTimer) {
    queue.startPolling();
  }
});
```

---

## 📊 页面元素对比

| 元素 | 专辑列表页面 | 队列页面 |
|-----|------------|---------|
| 布局方式 | 网格卡片 | 网格卡片 ✅ |
| 封面样式 | 正方形 | 正方形 ✅ |
| 悬停效果 | 上浮 + 阴影 | 上浮 + 阴影 ✅ |
| 信息展示 | 专辑名/艺术家 | 歌曲名/艺术家/点歌人 |
| 操作按钮 | 播放按钮 | 移除按钮 |
| 空状态 | "暂无专辑" | "队列为空" ✅ |
| 统计信息 | 无 | 4个统计卡片 |
| 页面标题 | 简单标题 | 标题+统计+操作 |

---

## 🧪 功能测试

### 测试场景 1: 查看队列页面

**步骤**:
1. 点击左侧菜单"点歌队列"
2. 页面跳转到队列页面

**预期结果**: ✅
- URL变为 `/song-queue`
- 显示队列页面标题
- 如果队列为空，显示空状态
- 如果有歌曲，显示网格布局

### 测试场景 2: 网格布局显示

**前提**: 队列中有至少5首歌曲

**步骤**:
1. 进入队列页面
2. 观察歌曲卡片布局

**预期结果**: ✅
- 歌曲以网格方式排列
- 每个卡片显示封面、序号、歌曲信息
- 当前播放的歌曲有特殊标识
- 响应式布局正常

### 测试场景 3: 统计信息

**步骤**:
1. 进入队列页面
2. 查看顶部统计卡片

**预期结果**: ✅
- 显示正确的队列数量
- 显示总时长
- 显示点歌人数
- 显示队列状态

### 测试场景 4: 开启队列模式

**步骤**:
1. 进入队列页面
2. 点击"开启队列模式"按钮
3. 播放任意歌曲并等待播放结束

**预期结果**: ✅
- 按钮文字变为"队列播放中"
- 按钮变为主色调
- 统计卡片状态变为"播放中"
- 歌曲播放完后自动播放队列歌曲

### 测试场景 5: 移除歌曲

**步骤**:
1. 悬停任意歌曲卡片
2. 点击右下角 ❌ 按钮
3. 确认移除

**预期结果**: ✅
- 悬停时显示操作按钮
- 点击后弹出确认框
- 确认后歌曲从队列消失
- 统计信息更新
- 显示成功提示

### 测试场景 6: 清空队列

**步骤**:
1. 点击"清空队列"按钮
2. 确认操作

**预期结果**: ✅
- 弹出确认框
- 确认后所有歌曲清空
- 显示空状态
- 统计信息重置
- 显示成功提示

### 测试场景 7: 空队列状态

**前提**: 队列为空

**步骤**:
1. 进入队列页面

**预期结果**: ✅
- 显示大尺寸队列图标
- 显示提示文字
- 显示"去发现音乐"按钮
- 操作按钮处于禁用状态

### 测试场景 8: 响应式布局

**步骤**:
1. 在PC端查看队列页面
2. 缩小浏览器窗口到移动端尺寸

**预期结果**: ✅
- PC端显示4-6列网格
- 移动端自动调整为2-3列
- 卡片大小适应
- 页面标题区布局调整

---

## 📁 文件清单

### 新增文件
```
SPlayer/src/views/Queue/
└── index.vue                # 队列页面组件（新建）
```

### 修改文件
```
SPlayer/src/components/Global/
└── Menu.vue                 # 添加队列菜单项

SPlayer/src/router/
└── routes.js                # 添加队列路由
```

---

## 🎊 更新总结

✅ **菜单入口**: 已添加到播客电台下方  
✅ **页面样式**: 采用专辑列表风格的网格布局  
✅ **响应式设计**: 支持PC和移动端  
✅ **功能完整**: 查看、管理、统计功能齐全  
✅ **交互流畅**: 悬停效果、动画过渡、二次确认  
✅ **实时同步**: 自动轮询更新队列状态  

---

## 🌐 访问方式

**公网**: https://music.jianzhile.vip/song-queue  
**局域网**: https://192.168.1.118:7899/song-queue

或通过侧边栏菜单：**播客电台 → 点歌队列**

---

## 💡 后续优化建议

1. **拖拽排序**: 支持拖拽调整队列顺序
2. **批量操作**: 支持批量移除歌曲
3. **筛选功能**: 按点歌人、时间筛选
4. **排序选项**: 按添加时间、歌曲名排序
5. **导出功能**: 导出队列为歌单
6. **播放控制**: 点击卡片直接播放该歌曲
7. **详情查看**: 点击歌曲查看详细信息
8. **分享功能**: 分享当前队列

---

现在可以通过侧边栏"点歌队列"菜单访问全新的队列页面了！🎉
